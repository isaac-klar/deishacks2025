<!DOCTYPE html>
<html lang="en">
<head>
    <title>Event Data Visualization</title>
    <script>
        async function handleFileUpload() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('/upload', {
                method: 'POST',
                body: formData,
            });

            const data = await response.json();

            const eventSelection = document.getElementById('event_selection');
            const eventsDropdown = document.getElementById('events');

            if (data.multiple_events) {
                eventSelection.style.display = 'block';
                eventsDropdown.innerHTML = '';

                data.events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event;
                    option.textContent = event;
                    eventsDropdown.appendChild(option);
                });
            } else {
                eventSelection.style.display = 'none';
            }
        }
    </script>
</head>
<body>
    <h1>Upload Event Data</h1>
    <form id="file-upload-form" action="/visualize" method="post" enctype="multipart/form-data">
        <!-- File Upload -->
        <label for="file">Upload Event File:</label>
        <input type="file" id="file" name="file" required onchange="handleFileUpload()"><br><br>

        <!-- Query Selection -->
        <label for="query">Select Query:</label>
        <select id="query" name="query" required>
            <option value="Attended">Attended</option>
            <option value="Member Status">Member Status</option>
            <option value="Sales">Sales</option>
        </select><br><br>

        <!-- Multi-Event Selection -->
        <div id="event_selection" style="display: none;">
            <label for="events">Select Events for Comparison:</label><br>
            <select id="events" name="events" multiple></select>
        </div>

        <!-- Submit Button -->
        <button type="submit">Generate Visualization</button>
    </form>
</body>
</html>
